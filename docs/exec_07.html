<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="이상일(서울대학교 지리교육과)">

<title>Data Science - 데이터 수집하기</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./exec_08.html" rel="next">
<link href="./exec_06.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">데이터 수집하기</h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">웹사이트 소개</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">데이터사이언스 강의</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">강의노트</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">R과 데이터사이언스</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R과 RStudio 소개</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R과 데이터사이언스: 개요</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 불러오기와 정리하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 변형하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 시각화하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터 탐색하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">데이터 수집하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터로 소통하기: Quarto 입문</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터로 소통하기: 대시보드 만들기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exec_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">데이터로 소통하기: 동적, 반응형 시각화</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">R 프레젠테이션</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R &amp; RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R &amp; Data Science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Import and Tidying</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Transformation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Collection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication with Data: Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication with Data: Dashboards</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_lec_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">R 실습</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab01: R과 RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab02: R과 데이터사이언스</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab03: 데이터 불러오기와 정리하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab04: 데이터 변형하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab05: 데이터 시각화하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab06: 데이터 탐색하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab07: 데이터 수집하기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab08: 데이터로 소통하기: Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab09: 데이터로 소통하기: 대시보드 만들기</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab10: 데이터로 소통하기: 동적, 반응형 시각화</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#실습-개요" id="toc-실습-개요" class="nav-link active" data-scroll-target="#실습-개요">실습 개요</a></li>
  <li><a href="#웹상의-데이터-파일-불러오기" id="toc-웹상의-데이터-파일-불러오기" class="nav-link" data-scroll-target="#웹상의-데이터-파일-불러오기"><span class="header-section-number">1</span> 웹상의 데이터 파일 불러오기</a></li>
  <li><a href="#웹스크레이핑" id="toc-웹스크레이핑" class="nav-link" data-scroll-target="#웹스크레이핑"><span class="header-section-number">2</span> 웹스크레이핑</a>
  <ul class="collapse">
  <li><a href="#html-기초" id="toc-html-기초" class="nav-link" data-scroll-target="#html-기초"><span class="header-section-number">2.1</span> HTML 기초</a></li>
  <li><a href="#html-요소의-선택" id="toc-html-요소의-선택" class="nav-link" data-scroll-target="#html-요소의-선택"><span class="header-section-number">2.2</span> HTML 요소의 선택</a></li>
  <li><a href="#웹스크레이핑-단계와-rvest-함수" id="toc-웹스크레이핑-단계와-rvest-함수" class="nav-link" data-scroll-target="#웹스크레이핑-단계와-rvest-함수"><span class="header-section-number">2.3</span> 웹스크레이핑 단계와 <code>rvest</code> 함수</a></li>
  <li><a href="#간단한-웹스크레이핑의-예" id="toc-간단한-웹스크레이핑의-예" class="nav-link" data-scroll-target="#간단한-웹스크레이핑의-예"><span class="header-section-number">2.4</span> 간단한 웹스크레이핑의 예</a></li>
  <li><a href="#웹스크레이핑의-실제-1-테이블이-하나-있는-경우" id="toc-웹스크레이핑의-실제-1-테이블이-하나-있는-경우" class="nav-link" data-scroll-target="#웹스크레이핑의-실제-1-테이블이-하나-있는-경우"><span class="header-section-number">2.5</span> 웹스크레이핑의 실제 1: 테이블이 하나 있는 경우</a></li>
  <li><a href="#웹스크레이핑의-실제-2-테이블이-둘-이상인-경우" id="toc-웹스크레이핑의-실제-2-테이블이-둘-이상인-경우" class="nav-link" data-scroll-target="#웹스크레이핑의-실제-2-테이블이-둘-이상인-경우"><span class="header-section-number">2.6</span> 웹스크레이핑의 실제 2: 테이블이 둘 이상인 경우</a></li>
  <li><a href="#웹스크레이핑의-실제-3-네이버-뉴스-데이터-수집하기" id="toc-웹스크레이핑의-실제-3-네이버-뉴스-데이터-수집하기" class="nav-link" data-scroll-target="#웹스크레이핑의-실제-3-네이버-뉴스-데이터-수집하기"><span class="header-section-number">2.7</span> 웹스크레이핑의 실제 3: 네이버 뉴스 데이터 수집하기</a></li>
  </ul></li>
  <li><a href="#api의-활용" id="toc-api의-활용" class="nav-link" data-scroll-target="#api의-활용"><span class="header-section-number">3</span> API의 활용</a>
  <ul class="collapse">
  <li><a href="#정의" id="toc-정의" class="nav-link" data-scroll-target="#정의"><span class="header-section-number">3.1</span> 정의</a></li>
  <li><a href="#r에서-api를-활용한-데이터-수집" id="toc-r에서-api를-활용한-데이터-수집" class="nav-link" data-scroll-target="#r에서-api를-활용한-데이터-수집"><span class="header-section-number">3.2</span> R에서 API를 활용한 데이터 수집</a></li>
  <li><a href="#api를-활용한-kosis-데이터의-수집" id="toc-api를-활용한-kosis-데이터의-수집" class="nav-link" data-scroll-target="#api를-활용한-kosis-데이터의-수집"><span class="header-section-number">3.3</span> API를 활용한 KOSIS 데이터의 수집</a></li>
  <li><a href="#api를-활용한-naver-뉴스-데이터의-수집" id="toc-api를-활용한-naver-뉴스-데이터의-수집" class="nav-link" data-scroll-target="#api를-활용한-naver-뉴스-데이터의-수집"><span class="header-section-number">3.4</span> API를 활용한 NAVER 뉴스 데이터의 수집</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">데이터 수집하기</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>이상일(서울대학교 지리교육과) </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 19, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="실습-개요" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="실습-개요">실습 개요</h2>
<p>이 실습은 R로 데이터를 수집하는 과정을 다루다. R을 활용한 데이터 수집은 다양한 방법으로 진행될 수 있지만 여기서는 웹상의 데이터 파일 불러오기, 웹 스크레이핑, API를 이용하는 방식에 집중한다. 우선 <a href="https://www.tidyverse.org/"><code>tidyverse</code></a> 패키지를 불러온다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="웹상의-데이터-파일-불러오기" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="웹상의-데이터-파일-불러오기"><span class="header-section-number">1</span> 웹상의 데이터 파일 불러오기</h2>
<p>아마도 데이터를 수집하는 가장 단순한 방법은 웹상에 파일 형태로 존재하는 데이터를 R에서 불러오는 것일 것이다. <code>readr</code> 패키지에서 제공하는 다양한 데이터 불러오기 함수(예: <code>read_csv()</code>)를 데이터의 URL에 적용하면 손쉽게 데이터를 획득할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://pos.it/r4ds-students-csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>students</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  `Student ID` `Full Name`      favourite.food     mealPlan            AGE  
         &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;               &lt;chr&gt;
1            1 Sunil Huffmann   Strawberry yoghurt Lunch only          4    
2            2 Barclay Lynn     French fries       Lunch only          5    
3            3 Jayendra Lyne    N/A                Breakfast and lunch 7    
4            4 Leon Rossini     Anchovies          Lunch only          &lt;NA&gt; 
5            5 Chidiegwu Dunkel Pizza              Breakfast and lunch five 
6            6 Güvenç Attila    Ice cream          Lunch only          6    </code></pre>
</div>
</div>
<p>그런데 엑셀 형식의 파일은 <a href="https://readxl.tidyverse.org/"><code>readxl</code></a> 패키지가 제공하는 <code>read_excel()</code> 함수를 이용해서 막바로 불러올 수는 없다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">"https://github.com/awalker89/openxlsx/raw/master/inst/readTest.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: `path` does not exist: 'https://github.com/awalker89/openxlsx/raw/master/inst/readTest.xlsx'</code></pre>
</div>
</div>
<p><a href="https://ycphs.github.io/openxlsx/index.html"><code>openxlsx</code></a> 패키지는 이러한 문제를 해결할 수 있게 해준다. 정말 다양한 함수를 제공하지만 <code>read.xlsx()</code> 함수가 URL을 통해 엑셀 데이터를 불러오는데 사용된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>xlsx_data <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://github.com/awalker89/openxlsx/raw/master/inst/readTest.xlsx"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>xlsx_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Var1 Var2   Var3 Var4  Var5         Var6 Var7
1   TRUE    1   1.00    a 42042 3209324 This   NA
2   TRUE   NA     NA    b 42041         &lt;NA&gt;   NA
3   TRUE    2   1.34    c 42040         &lt;NA&gt;   NA
4  FALSE    2     NA &lt;NA&gt;    NA         &lt;NA&gt;   NA
5  FALSE    3   1.56    e    NA         &lt;NA&gt;   NA
6  FALSE    1   1.70    f 42037         &lt;NA&gt;   NA
7     NA   NA     NA &lt;NA&gt; 42036         &lt;NA&gt;   NA
8  FALSE    2  23.00    h 42035         &lt;NA&gt;   NA
9  FALSE    3  67.30    i 42034         &lt;NA&gt;   NA
10    NA    1 123.00 &lt;NA&gt; 42033         &lt;NA&gt;   NA</code></pre>
</div>
</div>
</section>
<section id="웹스크레이핑" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="웹스크레이핑"><span class="header-section-number">2</span> 웹스크레이핑</h2>
<p>웹스크레이핑(web scraping)이란 웹페이지로부터 특정한 데이터를 추출하는 것을 의미한다. R에서 웹스크레이핑은 <code>rvest</code> 패키지가 답당하는데, <code>reaxl</code> 패키지와 마찬가지로 <code>tidyverse</code>의 핵심 패키지는 아니기 때문에 따로 불러와야 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="html-기초" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="html-기초"><span class="header-section-number">2.1</span> HTML 기초</h3>
<p>거의 모든 웹페이지는 HTML(HyperText Markup Language, 하이퍼텍스트 마크업 언어)로 만들어져 있다. HTML은 웹브라우저(web browser)를 통해 표출되는 사항(무엇이 어떻게)을 프로그래밍하는 마크업(markup) 언어이다. 웹스크레이핑 맥락에서 HTML에 대한 몇 가지 기초 사항은 숙지할 필요가 있다.</p>
<ul>
<li><p>웹페이지는 태그(tag)로 이루어져 있다. 각 태그는 시작 테그와 종료(끝) 태그로 구성되며, 둘 사이에 콘텐츠가 놓인다. 태그를 중심으로 개별 단위를 엘리먼트(element)라고 부르기도 한다.</p></li>
<li><p>태그의 종류는 다양하다. 태그는 크게 세 가지로 구분되는데, 최상위인 html 태그, 웹페이지의 전반적인 구조를 결정하는 블록(block) 태그(예: hi, section, p, ol 태그 등), 블록 태그 내부의 특정 부분에만 적용되는 인라인(inline) 태그(예: b, i, a 태그 등)가 있다. 태그는 100종 이상이 존재한다고 하는데, 그 중 많이 사용되는 것으로 다음과 같은 것들이 있다.</p>
<ul>
<li><p>html 태그: 모든 웹페이지에 존재하는 최상위 태그로, 그 하위에 head 태그와 body 태그를 가져야함.</p></li>
<li><p>head 태그: 웹페이지의 제목이나 머릿말과 같은 메타데이터로 구성</p></li>
<li><p>body 태그: 본문에 해당하는 부분</p></li>
<li><p>title 태그: 타이틀바에 입력될 텍스트 지정</p></li>
<li><p>link 태그: 외부 css 파일을 연결</p></li>
<li><p>meta 태그: 문서의 다양한 정보를 제공</p></li>
<li><p>script 태그: 외부 js 파일을 연결하거나 javascript 코드를 입력</p></li>
<li><p>div 태그: 상자 영역을 생성</p></li>
<li><p>span 태그: 요소 일부분만 변경하고자 할 때 사용하는 것으로 대표적인 인라인 태그</p></li>
<li><p>img 태그: 이미지 태그</p></li>
<li><p>h 태그: 제목 생성</p>
<ul>
<li>h1, h2, h3, h4, h5, h6</li>
</ul></li>
<li><p>table 태그: 표 생성</p></li>
<li><p>p 태그: 문단 생성</p></li>
<li><p>ul 태그: 번호가 없는 리스트</p></li>
<li><p>ol 태그: 번호가 있는 리스트</p></li>
<li><p>li 태그: ul 태그나 ol 태그 내에서 사용</p></li>
<li><p>br 태그: 줄 바꿈 기능을 하는 단독 태그</p></li>
<li><p>b 태그: 굵은 글씨 지정</p></li>
<li><p>i 태그: 이탤릭체 글씨 지정</p></li>
<li><p>a 태그: 링크 이동</p></li>
<li><p>input 태그: 입력창을 생성</p></li>
<li><p>button 태그: 버튼을 생성</p></li>
<li><p>select 태그: 선택 박스 창을 생성</p></li>
<li><p>form 태그: 데이터 전송</p></li>
</ul></li>
<li><p>다양한 태그들이 복잡한 다단계 위계 구조를 이룬다.</p></li>
</ul>
<div id="fig-html-hier" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-html-hier-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://odinuv.cz/articles/html/"><img src="https://odinuv.cz/common/css/html.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-html-hier-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: HTML의 위계 구조 (https://odinuv.cz/articles/html/)
</figcaption>
</figure>
</div>
<ul>
<li><p>태그는 속성(attribute)을 가질 수 있다.</p>
<ul>
<li><p>특별히 중요한 속성: class, identity</p></li>
<li><p>p나 div 태그와 같은 블록 태그: height, width, margin, padding</p></li>
<li><p>img 태그: src, alt, width, height</p></li>
<li><p>a 태그: href</p></li>
</ul></li>
</ul>
</section>
<section id="html-요소의-선택" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="html-요소의-선택"><span class="header-section-number">2.2</span> HTML 요소의 선택</h3>
<p>HTML 요소란 태그와 속성으로 확정가능한 HTML의 특정 부분을 의미하는 것으로, 웹스크레이핑의 타깃의 주소와 같은 것이다.</p>
<section id="단일-수준에서의-요소-선택" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="단일-수준에서의-요소-선택"><span class="header-section-number">2.2.1</span> 단일 수준에서의 요소 선택</h4>
<p>선택 대상을 효과적으로 규정하기 위해 사용되는 것이 CSS(cascading style sheet) 선택자(selector)이다. CSS는 HTML의 시각적 구성을 통제하는 툴인데, html의 특정 부분을 지목할 수 있는 작은 언어(miniature language)를 가지고 있고, 그것을 CSS 선택자라 부르는 것이다.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>선택 대상</th>
<th>CSS 선택자</th>
<th>결과</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>태그(tag)</td>
<td>tag1</td>
<td>“tag1”이라는 이름의 모든 tag</td>
</tr>
<tr class="even">
<td>클래스(class)</td>
<td>.class1</td>
<td>“class1”이라는 class 속성을 갖는 모든 요소</td>
</tr>
<tr class="odd">
<td>아이디(id)</td>
<td>#id1</td>
<td>“id1”이라는 id 속성을 갖는 모든 요소</td>
</tr>
<tr class="even">
<td>tag과 class의 결합</td>
<td>tag1.class1</td>
<td>“tag1”이라는 tag의 “class1”이라는 class 속성을 가진 모든 요소</td>
</tr>
<tr class="odd">
<td>class1와 class2의 결합</td>
<td>.class1.class2</td>
<td>“class1”이라는 이름의 class 속성과 “class2”라는 이름의 class 속성을 동시에 갖는 모든 요소</td>
</tr>
</tbody>
</table>
</section>
<section id="하위-요소의-선택" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="하위-요소의-선택"><span class="header-section-number">2.2.2</span> 하위 요소의 선택</h4>
<p>동일 수준에서 한 요소를 선택한 이후 그 하위에 있는 요소를 위계적으로 선정하는 과정이다. 만약 div 태그의 하위에 있는 span 태그의 하위에 있는 a 태그를 선택하고 싶다면 태그의 위계에 따라 요소를 나열하면 된다(div span a).</p>
</section>
<section id="정확한-선택자의-확인" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="정확한-선택자의-확인"><span class="header-section-number">2.2.3</span> 정확한 선택자의 확인</h4>
<p>정확한 선택자를 확인하는 것이 성공적인 웹스크레이핑을 위한 관건이다. 보통 해당 웹페이지에서 오른쪽 마우스 버튼을 누른 뒤 “검사”를 선택하여 이리저리 살펴보아야 한다. <a href="https://rvest.tidyverse.org/articles/selectorgadget.html">SelectorGadget</a>과 같은 브라우저 확장 프로그램이 도움이 될 수 있다. 링크로 들어가면 간단한 사용 방법을 살펴볼 수 있다.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>다양한 웹브라우저가 있지만 웹스크레이핑에서 가장 권장되는 것은 구글(Google)의 크롬(Chrome)이다.</p>
</div>
</div>
</section>
</section>
<section id="웹스크레이핑-단계와-rvest-함수" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="웹스크레이핑-단계와-rvest-함수"><span class="header-section-number">2.3</span> 웹스크레이핑 단계와 <code>rvest</code> 함수</h3>
<p><strong>1단계</strong>는 웹페이지 읽기 단계이다.</p>
<p><code>read_html()</code> 함수를 이용해 웹페이지를 읽어 들인다.</p>
<p><strong>2단계</strong>는 HTML 요소의 선택 단계이다.</p>
<ul>
<li><p><code>html_elements()</code>함수</p>
<ul>
<li><p>조건의 만족 여부에 따라, 인풋보다 더 많은 혹은 더 적은 갯수의 아웃풋을 산출할 수 있음</p>
<ul>
<li><p>html 전체에 적용했을 때: 조건을 만족하는 모든 케이스를 리턴</p></li>
<li><p>하위 요소에 적용했을 때: 조건을 만족하지 않는 케이스는 누락</p></li>
</ul></li>
<li><p>주로 관측개체를 추출할 때 사용</p></li>
</ul></li>
<li><p><code>html_element()</code>함수</p>
<ul>
<li><p>조건의 만족 여부와 관계없이, 항상 인풋과 동일한 갯수의 아웃풋을 산출</p>
<ul>
<li><p>html 전체에 적용했을 때: 조건을 만족하는 것들 중 첫번째 케이스만 리턴</p></li>
<li><p>하위 요소에 적용했을 때: 조건을 만족하지 않는 케이스도 NA의 형태로 잔존</p></li>
</ul></li>
<li><p>주로 변수를 추출할 때 사용</p></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>html_elements()</code>와 <code>html_element()</code>의 관계를 보다 명확히 할 필요가 있다. 우선 html 문서 전체에서 특정한 선택자를 만족하는 요소를 찾는 것이 목적이라면 <code>html_elements()</code>를 사용하는 것이 합리적인 선택이다. 해당 조건을 만족하는 것이 둘 이상일 가능성이 높기 때문이다. 오직 하나만 있다고 확신할 수 있는 경우는 <code>html_element()</code>를 사용해도 무방하다. 그런데 html 문서 전체에서 만족하는 요소가 없는 경우에는 둘의 차이가 극명하게 나타난다. <code>html_elements()</code>는 만족하는 요소가 없으므로 아무 것도 리턴하지 않는다(실질적으로 길이가 0인 벡터를 리턴). <code>html_element()</code>는 인풋이 전체 html 하나 였으므로 하나의 요소(NA 요소)를 리턴한다. 그런데 이러한 차이의 중요성은 계층 체계를 따라 보다 하위 요소를 선택하고자 할 때 더 크게 드러난다. <code>html_elements()</code>를 통해 다수의 케이스가 선택되었고 단계적으로 하위 요소들을 선택하고자 할 때 어떤 케이스는 모든 하위 요소를 가지고 있지만 어떤 케이스는 특정 하위 요소를 누락하고 있을 수 있다. 이런 경우 하위 요소의 선택을 위해 <code>html_elements()</code>를 적용하게 되면, 누락된 하위 요소를 가진 케이스는 아웃풋에서 삭제된다. 즉, 누락이 없는 하위 요소의 경우는 모든 케이스가 아웃풋에 나타나지만, 누락이 있는 하위 요소의 경우는 어떤 케이스는 아웃풋에 나타나지 않게 된다. 이에 반해 <code>html_element()</code>은 조건의 만족 여부에 관계 없이 항상 인풋과 동일한 갯수의 아웃풋을 산출하므로, 누락된 하위 요소를 가진 케이스인 경우도 NA값을 부여받고 아웃풋에 포함된다. 이런 이유로 <code>html_elements()</code>는 주로 관측개체를 추출할 때 사용하고, <code>html_element()</code>는 주로 변수를 추출할 때 사용한다고 말하는 것이다.</p>
</div>
</div>
<p><strong>3단계</strong>는 하위 요소의 선택 단계이다. 여기에는 두 가지 방식이 있다.</p>
<ul>
<li><p><code>html_element()</code>함수나 <code>html_elements()</code> 함수 속에 요소들을 위계에 따라 나열을 하되 요소 사이에 공란을 둔다.</p></li>
<li><p>파이프 연사자(pipe operator)를 활용한다.</p></li>
</ul>
<p><strong>4단계</strong>는 요소로부터 데이터를 추출하는 단계이다. 다양한 함수를 적용할 수 있다.</p>
<ul>
<li><p><code>html_table()</code>: 테이블 데이터의 추출</p></li>
<li><p><code>html_text()</code>: 텍스트 데이터의 추출</p></li>
<li><p><code>html_text2()</code>: 불필요한 부호와 공란을 제거한 텍스트 데이터의 추출</p></li>
<li><p><code>html_attr()</code>과 <code>html_attrs()</code>: 하위 속성 데이터의 추출</p></li>
</ul>
</section>
<section id="간단한-웹스크레이핑의-예" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="간단한-웹스크레이핑의-예"><span class="header-section-number">2.4</span> 간단한 웹스크레이핑의 예</h3>
<section id="데이터" class="level4" data-number="2.4.1">
<h4 data-number="2.4.1" class="anchored" data-anchor-id="데이터"><span class="header-section-number">2.4.1</span> 데이터</h4>
<p><code>rvest</code> 패키지에 내장되어 있는 예제(<a href="https://rvest.tidyverse.org/articles/starwars.html">starwars</a>)를 활용하여 실습을 진행한다. 웹페이지에 접속하여 어떤 내용으로 구성되어 있는지 확인한다. 앞에서 언급한 것처럼, 오른쪽 마우스 버튼을 누르고 “검사”를 선택하면 해당 패이지의 HTML 구조를 살펴볼 수 있다. 모든 영화가 다음과 같은 동일한 구조를 가지고 있음을 확인한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>section<span class="sc">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>h2 data<span class="sc">-</span>id<span class="ot">=</span><span class="st">"1"</span><span class="sc">&gt;</span>The Phantom Menace<span class="sc">&lt;</span><span class="er">/</span>h2<span class="sc">&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>p<span class="sc">&gt;</span>Released<span class="sc">:</span> <span class="dv">1999-05-19</span><span class="sc">&lt;</span><span class="er">/</span>p<span class="sc">&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>p<span class="sc">&gt;</span>Director<span class="sc">:</span> <span class="er">&lt;</span>span class<span class="ot">=</span><span class="st">"director"</span><span class="sc">&gt;</span>George Lucas<span class="sc">&lt;</span><span class="er">/</span>span<span class="sc">&gt;</span><span class="er">&lt;/</span>p<span class="sc">&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>div class<span class="ot">=</span><span class="st">"crawl"</span><span class="sc">&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>p<span class="sc">&gt;</span>...<span class="sc">&lt;</span><span class="er">/</span>p<span class="sc">&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>p<span class="sc">&gt;</span>...<span class="sc">&lt;</span><span class="er">/</span>p<span class="sc">&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>p<span class="sc">&gt;</span>...<span class="sc">&lt;</span><span class="er">/</span>p<span class="sc">&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>div<span class="sc">&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>section<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>우리의 웹스크레이핑 목적은 7개의 영화별로 제목(title), 연도(year), 감독(director), 요약(intro) 컬럼을 갖는 데이터 프레임을 생성하는 것이다.</p>
</section>
<section id="웹스크레이핑의-과정" class="level4" data-number="2.4.2">
<h4 data-number="2.4.2" class="anchored" data-anchor-id="웹스크레이핑의-과정"><span class="header-section-number">2.4.2</span> 웹스크레이핑의 과정</h4>
<p>read_html() 함수를 이용하여 웹페이지를 읽어 들인다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://rvest.tidyverse.org/articles/starwars.html"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>“section” 태그 요소를 선택한다. 조건을 만족하는 모든 케이스를 추출해야 하므로 <code>html_elements()</code> 함수를 사용한다. 관측개체가 7개임을 확인한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>section <span class="ot">&lt;-</span> html <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"section"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>section</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (7)}
[1] &lt;section&gt;&lt;h2 data-id="1"&gt;\nThe Phantom Menace\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 1999 ...
[2] &lt;section&gt;&lt;h2 data-id="2"&gt;\nAttack of the Clones\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 20 ...
[3] &lt;section&gt;&lt;h2 data-id="3"&gt;\nRevenge of the Sith\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 200 ...
[4] &lt;section&gt;&lt;h2 data-id="4"&gt;\nA New Hope\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 1977-05-25\n ...
[5] &lt;section&gt;&lt;h2 data-id="5"&gt;\nThe Empire Strikes Back\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: ...
[6] &lt;section&gt;&lt;h2 data-id="6"&gt;\nReturn of the Jedi\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 1983 ...
[7] &lt;section&gt;&lt;h2 data-id="7"&gt;\nThe Force Awakens\n&lt;/h2&gt;\n&lt;p&gt;\nReleased: 2015- ...</code></pre>
</div>
</div>
<p>제목과 감독명에 대한 선택자가 각각 h2 태그와 director 클래스에 들어가 있음을 알 수 있다. <code>html_element()</code>와 <code>html_text2()</code> 함수를 활용하여 데이터를 추출한다. 앞에서 언급한 것처럼 구체적인 변수를 생성하기 위한 작업에는 케이스의 누락을 방지하기 위해 <code>html_element()</code>를 사용한다. <code>html_text()</code> 함수도 존재하지만 더 좋은 결과물을 얻을 수 있는 <code>html_text2()</code> 함수를 항상 사용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>section <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"h2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Phantom Menace"      "Attack of the Clones"   
[3] "Revenge of the Sith"     "A New Hope"             
[5] "The Empire Strikes Back" "Return of the Jedi"     
[7] "The Force Awakens"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>section <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">".director"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "George Lucas"     "George Lucas"     "George Lucas"     "George Lucas"    
[5] "Irvin Kershner"   "Richard Marquand" "J. J. Abrams"    </code></pre>
</div>
</div>
</section>
</section>
<section id="웹스크레이핑의-실제-1-테이블이-하나-있는-경우" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="웹스크레이핑의-실제-1-테이블이-하나-있는-경우"><span class="header-section-number">2.5</span> 웹스크레이핑의 실제 1: 테이블이 하나 있는 경우</h3>
<p>위키피디어의 전 세계 국가 관련 항목(List of countries and dependencies by population)에는 표가 하나 들어있는데, 해당 표의 데이터를 웹스크레이핑 기법을 활용해 수집해 보기로 한다. 테이블이 하나이므로 <code>html_element()</code> 함수를 사용하고, 데이터 형식이 테이블이므로 <code>html_table()</code> 함수를 적용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population"</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>my_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 241 × 7
   ``      Location    Population `% ofworld` Date  Source (official or …¹ ``   
   &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                  &lt;chr&gt;
 1 –       World       8,119,186… 100%        19 J… UN projection[3]       ""   
 2 1/2 [b] China       1,409,670… 17.4%       31 D… Official estimate[5]   "[c]"
 3 1/2 [b] India       1,404,910… 17.3%       1 Ju… Official projection[6] "[d]"
 4 3       United Sta… 335,893,2… 4.1%        1 Ja… Official estimate[7]   "[e]"
 5 4       Indonesia   281,603,8… 3.5%        1 Ju… National annual proje… ""   
 6 5       Pakistan    241,499,4… 3.0%        1 Ma… 2023 census result[9]  "[f]"
 7 6       Nigeria     223,800,0… 2.8%        1 Ju… Official projection[1… ""   
 8 7       Brazil      203,080,7… 2.5%        1 Au… 2022 census result[11] ""   
 9 8       Bangladesh  169,828,9… 2.1%        14 J… 2022 census result[12] ""   
10 9       Russia      146,150,7… 1.8%        1 Ja… Official estimate[13]  "[g]"
# ℹ 231 more rows
# ℹ abbreviated name: ¹​`Source (official or fromthe United Nations)`</code></pre>
</div>
</div>
<p>결과물이 정돈된 데이터가 아니다. 앞에서 배운 기법을 활용해 데이터를 정리한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>my_table_new <span class="ot">&lt;-</span> my_table <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"Location"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="st">"Population"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_pct =</span> <span class="st">"% ofworld"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="st">"Date"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"Source (official or fromthe United Nations)"</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">parse_number</span>(population, <span class="st">","</span>),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">as.numeric</span>(population),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_pct =</span> <span class="fu">str_remove_all</span>(pop_pct, <span class="st">"%"</span>),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_pct =</span> <span class="fu">as.numeric</span>(pop_pct),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">dmy</span>(date)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>my_table_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 241 × 5
   location      population pop_pct date       source                       
   &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;                        
 1 World         8119186000   100   2024-07-19 UN projection[3]             
 2 China         1409670000    17.4 2023-12-31 Official estimate[5]         
 3 India         1404910000    17.3 2024-07-01 Official projection[6]       
 4 United States  335893238     4.1 2024-01-01 Official estimate[7]         
 5 Indonesia      281603800     3.5 2024-07-01 National annual projection[8]
 6 Pakistan       241499431     3   2023-03-01 2023 census result[9]        
 7 Nigeria        223800000     2.8 2023-07-01 Official projection[10]      
 8 Brazil         203080756     2.5 2022-08-01 2022 census result[11]       
 9 Bangladesh     169828911     2.1 2022-06-14 2022 census result[12]       
10 Russia         146150789     1.8 2024-01-01 Official estimate[13]        
# ℹ 231 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>코드에 포함된 <code>parse_number()</code>과 <code>str_remove_all()</code> 함수는 매우 유용한 함수이므로 잘 익혀 둘 필요가 있다. <code>parse_number()</code>함수는 <code>readr</code> 패키지에 포함되어 있는 것으로, 투입 벡터에서 오로지 숫자만 골라내 실수형 벡터를 생성해준다. 위의 예를 보자면, my_table 데이터 프레임의 population 컬럼은 인구수와 콤마가 결합된 문자형 벡터이므로 콤마를 제거하고 숫자만 추출할 필요가 있다. 유사한 함수에 <code>parse_logical()</code>, <code>parse_integer()</code>, <code>parse_double()</code>, <code>parse_character()</code>, <code>parse_factor()</code> 등이 있다. <code>str_remove_all()</code> 함수는 <code>tidyverse</code>의 핵심 패키지 중의 하나인 <code>stringr</code> 패키지에 포함되어 있는 것으로, 투입 벡터에서 특정한 문자나 문자 패턴을 제거해 준다. 위의 예를 보자면, my_table 데이터 프레임의 pop_pct 컬럼에는 %라는 부호가 포함되어 있기 때문에 그것을 제거할 필요가 있다. 그러므로 <code>str_remove_all()</code> 함수는 셀에 포함되어 있는 특정 문자 모두를 제거할 때 사용할 수 있는 함수이다. 유사한 함수에 <code>str_remove()</code>도 있는데, 이것은 셀에 포함되어 있는 특정 문자 중 단지 첫 번째 것만 제거한다. 문자열을 잘 다루려면 정규표현식(regular expression)에 대한 상당한 이해가 있어야 한다. 다음의 링크가 도움이 될 수 있을 것이다. <a href="https://bookdown.org/ahn_media/bookdown-demo/cleantool.html#%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9Dregular-expressions" class="uri">https://bookdown.org/ahn_media/bookdown-demo/cleantool.html#%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9Dregular-expressions</a></p>
</div>
</div>
<p>종종 웹스크레이핑으로 불러온 한글 데이터가 깨지는 경우가 있다. read_html() 함수 속에 encoding 아규먼트에 “EUC-KR”이나 “UTF-8”을 지정하면 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>kospi <span class="ot">&lt;-</span> <span class="st">"https://finance.naver.com/sise/sise_quant.naver?sosok=0"</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>kospi_table <span class="ot">&lt;-</span> kospi <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>(<span class="at">encoding =</span> <span class="st">"EUC-KR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>kospi_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 5 × 6
  X1       X2           X3                 X4           X5               X6     
  &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;              &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;  
1 "거래량" "매수호가"   "거래대금(백만)"   시가총액(억) 영업이익(억)     PER(배)
2 "시가"   "매도호가"   "전일거래량"       자산총계(억) 영업이익증가율   ROE(%) 
3 "고가"   "매수총잔량" "외국인비율"       부채총계(억) 당기순이익(억)   ROA(%) 
4 "저가"   "매도총잔량" "상장주식수(천주)" 매출액(억)   주당순이익(원)   PBR(배)
5 ""       ""           ""                 매출액증가율 보통주배당금(원) 유보율…

[[2]]
# A tibble: 161 × 12
       N 종목명  현재가 전일비 등락률 거래량 거래대금 매수호가 매도호가 시가총액
   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
 1    NA ""      ""     ""     ""     ""     ""       ""       ""       ""      
 2     1 "KODEX… "1,88… "상승… "+2.3… "198,… "374,45… "1,883"  "1,884"  "18,207"
 3     2 "일신…  "1,48… "상승… "+6.6… "40,8… "62,974" "1,485"  "1,486"  "1,150" 
 4     3 "인디…  "961"  "상승… "+5.4… "31,7… "32,569" "961"    "964"    "722"   
 5     4 "KODEX… "3,54… "하락… "-0.9… "26,7… "95,724" "3,535"  "3,540"  "3,501" 
 6     5 "에이…  "1,33… "상승… "+17.… "26,4… "33,737" "1,334"  "1,335"  "1,767" 
 7    NA ""      ""     ""     ""     ""     ""       ""       ""       ""      
 8    NA ""      ""     ""     ""     ""     ""       ""       ""       ""      
 9    NA ""      ""     ""     ""     ""     ""       ""       ""       ""      
10     6 "GS글…  "3,66… "상승… "+6.0… "24,8… "89,992" "3,660"  "3,665"  "3,025" 
# ℹ 151 more rows
# ℹ 2 more variables: PER &lt;chr&gt;, ROE &lt;chr&gt;</code></pre>
</div>
</div>
<p>여기서는 리시트가 산출되었으므로 다음과 같은 방식으로 데이터 프레임을 생성한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>kospi_res <span class="ot">&lt;-</span> kospi_table <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  _[[<span class="dv">2</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(N))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>kospi_res <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 12
      N 종목명   현재가 전일비 등락률 거래량 거래대금 매수호가 매도호가 시가총액
  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
1     1 KODEX 2… 1,884  "상승… +2.39% 198,1… 374,452  1,883    1,884    18,207  
2     2 일신석재 1,485  "상승… +6.60% 40,85… 62,974   1,485    1,486    1,150   
3     3 인디에프 961    "상승… +5.49% 31,70… 32,569   961      964      722     
4     4 KODEX …  3,540  "하락… -0.98% 26,79… 95,724   3,535    3,540    3,501   
5     5 에이프…  1,335  "상승… +17.3… 26,45… 33,737   1,334    1,335    1,767   
# ℹ 2 more variables: PER &lt;chr&gt;, ROE &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="웹스크레이핑의-실제-2-테이블이-둘-이상인-경우" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="웹스크레이핑의-실제-2-테이블이-둘-이상인-경우"><span class="header-section-number">2.6</span> 웹스크레이핑의 실제 2: 테이블이 둘 이상인 경우</h3>
<p>위키피디어의 국가별 약어 관련 항목(List of FIPS country codes)에는 동일한 내용이 여러개로 표로 나뉘어 제시되어 있다. 개별 표의 데이터를 수집한 후 결합하여 단일한 데이터 프레임을 구성할 필요가 있다. 테이블이 여러개이므로 <code>html_elements()</code> 함수를 사용한다. <code>bind_rows()</code> 함수를 활용하여 테이블들을 하나의 테이블로 만든다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_FIPS_country_codes"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>my_tables <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>my_tables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 283 × 10
   Code    `Short-form name` .mw-parser-output .n…¹ .mw-parser-output .n…² ...3 
   &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;                  &lt;chr&gt;                  &lt;chr&gt;
 1 .mw-pa… Aruba             &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 2 AC      Antigua and Barb… &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 3 AE      United Arab Emir… &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 4 AF      Afghanistan       &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 5 AG      Algeria           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 6 AJ      Azerbaijan        &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 7 AL      Albania           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 8 AM      Armenia           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
 9 AN      Andorra           &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
10 AO      Angola            &lt;NA&gt;                   &lt;NA&gt;                   &lt;NA&gt; 
# ℹ 273 more rows
# ℹ abbreviated names:
#   ¹​`.mw-parser-output .navbar{display:inline;font-size:88%;font-weight:normal}.mw-parser-output .navbar-collapse{float:left;text-align:left}.mw-parser-output .navbar-boxtext{word-spacing:0}.mw-parser-output .navbar ul{display:inline-block;white-space:nowrap;line-height:inherit}.mw-parser-output .navbar-brackets::before{margin-right:-0.125em;content:"[ "}.mw-parser-output .navbar-brackets::after{margin-left:-0.125em;content:" ]"}.mw-parser-output .navbar li{word-spacing:-0.125em}.mw-parser-output .navbar a&gt;span,.mw-parser-output .navbar a&gt;abbr{text-decoration:inherit}.mw-parser-output .navbar-mini abbr{font-variant:small-caps;border-bottom:none;text-decoration:none;cursor:inherit}.mw-parser-output .navbar-ct-full{font-size:114%;margin:0 7em}.mw-parser-output .navbar-ct-mini{font-size:114%;margin:0 4em}@media screen{html.skin-theme-clientpref-night .mw-parser-output .navbar li a abbr{color:var(--color-base)!important}}@media screen and (prefers-color-scheme:dark){html.skin-theme-clientpref-os .mw-parser-output .navbar li a abbr{color:var(--color-base)!important}}vteGeocode systems...1`,
#   ²​`.mw-parser-output .navbar{display:inline;font-size:88%;font-weight:normal}.mw-parser-output .navbar-collapse{float:left;text-align:left}.mw-parser-output .navbar-boxtext{word-spacing:0}.mw-parser-output .navbar ul{display:inline-block;white-space:nowrap;line-height:inherit}.mw-parser-output .navbar-brackets::before{margin-right:-0.125em;content:"[ "}.mw-parser-output .navbar-brackets::after{margin-left:-0.125em;content:" ]"}.mw-parser-output .navbar li{word-spacing:-0.125em}.mw-parser-output .navbar a&gt;span,.mw-parser-output .navbar a&gt;abbr{text-decoration:inherit}.mw-parser-output .navbar-mini abbr{font-variant:small-caps;border-bottom:none;text-decoration:none;cursor:inherit}.mw-parser-output .navbar-ct-full{font-size:114%;margin:0 7em}.mw-parser-output .navbar-ct-mini{font-size:114%;margin:0 4em}@media screen{html.skin-theme-clientpref-night .mw-parser-output .navbar li a abbr{color:var(--color-base)!important}}@media screen and (prefers-color-scheme:dark){html.skin-theme-clientpref-os .mw-parser-output .navbar li a abbr{color:var(--color-base)!important}}vteGeocode systems...2`
# ℹ 5 more variables: ...4 &lt;chr&gt;, ...5 &lt;chr&gt;, ...6 &lt;chr&gt;, X1 &lt;chr&gt;, X2 &lt;chr&gt;</code></pre>
</div>
</div>
<p>앞에서 배운 기법을 활용해 데이터를 정리한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>my_tables_new <span class="ot">&lt;-</span> my_tables <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="st">"Code"</span>, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_name =</span> <span class="st">"Short-form name"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="fu">str_extract</span>(code, <span class="st">"[A-Z][A-Z]"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>my_tables_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 283 × 2
   code  short_name          
   &lt;chr&gt; &lt;chr&gt;               
 1 AA    Aruba               
 2 AC    Antigua and Barbuda 
 3 AE    United Arab Emirates
 4 AF    Afghanistan         
 5 AG    Algeria             
 6 AJ    Azerbaijan          
 7 AL    Albania             
 8 AM    Armenia             
 9 AN    Andorra             
10 AO    Angola              
# ℹ 273 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>str_extract()</code> 함수는 <code>str_remove_all()</code> 함수와 마찬가지로 <code>tidyverse</code>의 핵심 패키지 중의 하나인 <code>stringr</code> 패키지에 포함되어 있는 것으로, 벡터에서 특정한 문자나 문자 패턴을 추출해 준다. 무슨 이유에선지 모르겠지만 웹스크레이핑 결과 도출된 my_tables의 code 컬럼의 첫 번째 행에는 “.mw-parser-output .monospaced{font-family:monospace,monospace}AA”와 같은 이상한 정보가 포함되어 있다. 우리가 필요로 하는 것은 맨 끝에 있는 국가 약어인 AA이므로 그것만 추출해야 한다. <code>str_extract()</code> 함수 속에 포함되어 있는 “[A-Z][A-Z]”는 문자 패턴을 나타내는 것으로 “알파벳 대문자 두개가 연결되어 있는 것”을 의미한다. 그러므로 code 컬럼의 다른 모든 행에는 알파벳 대문자가 두 개 연결된 형태로 되어 있으므로 천 번째 열에서 AA를 추출해 최종적인 데이터를 산출한다.</p>
</div>
</div>
</section>
<section id="웹스크레이핑의-실제-3-네이버-뉴스-데이터-수집하기" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="웹스크레이핑의-실제-3-네이버-뉴스-데이터-수집하기"><span class="header-section-number">2.7</span> 웹스크레이핑의 실제 3: 네이버 뉴스 데이터 수집하기</h3>
<section id="기간을-설정하지-않은-경우" class="level4" data-number="2.7.1">
<h4 data-number="2.7.1" class="anchored" data-anchor-id="기간을-설정하지-않은-경우"><span class="header-section-number">2.7.1</span> 기간을 설정하지 않은 경우</h4>
<p>네이버 신문(<a href="https://news.naver.com/" class="uri">https://news.naver.com/</a>)에 키워드(예: 지방소멸)로 검색한 기사를 제목과 내용으로 나누어 데이터를 수집한다. 위에서 익힌 <code>rvest</code> 패키지의 함수들을 이용해 이 작업을 수행할 수 있다. 그런데 문제가 있는데, 실행을 해보면, 단지 10개의 케이스에 대해서만 데이터가 수집된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://search.naver.com/search.naver?where=news&amp;ie=utf8&amp;sm=nws_hty&amp;query=%EC%A7%80%EB%B0%A9%EC%86%8C%EB%A9%B8"</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".news_tit"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>contents <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".dsc_txt_wrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>my_news <span class="ot">&lt;-</span> <span class="fu">tibble</span>(title, contents)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>my_news</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="기간을-설정한-경우" class="level4" data-number="2.7.2">
<h4 data-number="2.7.2" class="anchored" data-anchor-id="기간을-설정한-경우"><span class="header-section-number">2.7.2</span> 기간을 설정한 경우</h4>
<p>동일한 방법을 활용해, 특정한 기간을 설정하여 데이터를 수집할 수 있다. 여기서는 2023년 1월 1일부터 2023년 12월 31일까지로 기간을 설정하여 데이터를 수집한다. 위의 경우와 마찬가지로 단지 10개의 케이스에 대해서만 데이터가 수집된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>start.date <span class="ot">&lt;-</span> <span class="st">"2023.01.01"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>end.date <span class="ot">&lt;-</span> <span class="st">"2023.12.31"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"https://search.naver.com/search.naver?where=news&amp;query=%EC%A7%80%EB%B0%A9%EC%86%8C%EB%A9%B8&amp;sm=tab_opt&amp;sort=0&amp;photo=0&amp;field=0&amp;pd=3&amp;ds="</span>, start.date, <span class="st">"&amp;de="</span>, end.date, <span class="st">"&amp;docid=&amp;related=0&amp;mynews=0&amp;office_type=0&amp;office_section_code=0&amp;news_office_checked=&amp;nso=so%3Ar%2Cp%3Afrom20230101to20231231&amp;is_sug_officeid=0&amp;office_category=0&amp;service_area=0"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".news_tit"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>contents <span class="ot">&lt;-</span> url <span class="sc">|&gt;</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".dsc_txt_wrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>my_news <span class="ot">&lt;-</span> <span class="fu">tibble</span>(title, contents)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>my_news</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>종래에는 위와 같은 방식에 반복 프로그래밍을 결합하면 원하는 케이스만큼의 데이터를 구할 수 있었다. 많은 웹사이트들이 웹스크레이핑을 방지하는 장치들을 하고 있고, 그러한 조치의 영향이 아닌가 추측한다. 따라서 뒤에서 다루게될 API를 이용하는 방식으로 옮아갈 필요가 있다.</p>
</div>
</div>
</section>
</section>
</section>
<section id="api의-활용" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="api의-활용"><span class="header-section-number">3</span> API의 활용</h2>
<section id="정의" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="정의"><span class="header-section-number">3.1</span> 정의</h3>
<p>API(application programming interface)는 복수의 프로그램들이 서로 상호작용하는 방법을 정의하는 일련의 규칙을 의미한다. 다른 말로 하면 한 프로그램이 다른 프로그램의 기능들을 불러 사용할 수 있게 해주는 통로를 의미한다.</p>
<p>이런 API 개념이 데이터 수집과 관련하여 중요한 의미를 가지는 것은 개방 API(open API) 때문이다. 개방 API는 데이터를 보유하고 있는 공적 기관이 데이터의 사용 권한을 사용자들에게 부여함으로써 데이터에 대한 접근 가능성을 높여주기 때문이다.</p>
<p>만일 개방 API가 존재하는 상황이라면 데이터사이언스의 가장 좋은 데이터 수집 방법은 오픈 API를 활용하는 것이다.</p>
</section>
<section id="r에서-api를-활용한-데이터-수집" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="r에서-api를-활용한-데이터-수집"><span class="header-section-number">3.2</span> R에서 API를 활용한 데이터 수집</h3>
<p>최근까지 API를 활용한 데이터 수집에는 <code>httr</code>과 <code>jsonlite</code>라는 두 개의 패키지가 함께 사용되었다. 그런데 최근 <code>httr</code>의 완전 업그레이드 버전인 <code>httr2</code>가 선을 보이면서 이 패키지를 단독으로 활용하는 방식이 주목 받고 있다(<a href="https://httr2.r-lib.org/" class="uri">https://httr2.r-lib.org/</a>). <code>httr2</code>는 R의 <code>tidyverse</code> 운동을 이끌고 있는 해들리 위컴(Hadley Wickham)이 <code>tidyverse</code>의 철학에 맞추어 <code>httr</code> 패키지를 발전시킨 것이다. 이러한 R 패키지를 직접 활용하는 것이 가장 좋은 방법이겠지만, 초보자의 경우 다소간의 어려움을 겪을 수 있다. <code>httr2</code> 함수가 다른 패키지의 함수에 비해 개념적으로 이해하기 어려운 측면이 있기 때문이기도 하고, 데이터를 획득하는 구체적인 과정이 API 마다 조금씩 다르기 때문이기도 하다.</p>
<p>이러한 어려움을 들어주기 위해 일종의 연결 패키지들이 개발되어 있는데, 이러한 패키지를 래퍼 패키지(wrapper package)라고 부른다. 래퍼 패키지들은 사용자와 API 수집용 패키지 사이에서 일종의 가교 역할을 하는 것으로, 사용자들이 사용하기 편한 함수를 제공함으로써 보다 손쉽게 오픈 API를 활용할 수 있게 도와준다. 예를 들어, 구글맵스플랫폼(Google Maps Platform)에 API로 접근해 다양한 기능을 활용할 수 있게 도와주는 <code>googleway</code>와 같은 패키지가 좋은 예가 될 수 있다.</p>
</section>
<section id="api를-활용한-kosis-데이터의-수집" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="api를-활용한-kosis-데이터의-수집"><span class="header-section-number">3.3</span> API를 활용한 KOSIS 데이터의 수집</h3>
<p>KOSIS를 포함한 많은 대한민국의 데이터 포털은 개방 API 서비스를 제공하고 있다. KOSIS는 공유서비스 홈페이지(<a href="https://kosis.kr/openapi/index.jsp" class="uri">https://kosis.kr/openapi/</a>)를 통해 Open API를 통한 데이터 수집을 권장하고 있다. 개발 가이드(<a href="https://kosis.kr/openapi/devGuide/devGuide_0101List.do" class="uri">https://kosis.kr/openapi/devGuide/devGuide_0101List.do</a>)를 통해 R을 포함한 다양한 프로그래밍 언어에서 KOSIS의 개방 API 서비스를 활용하는 구체적인 코드를 제공하고 있기도 하다. 가이드 북을 읽어 보면, 앞에서 언급한 R의 <code>httr</code>, <code>jsonlite</code>, <code>rvest</code>와 같은 패키지가 활용됨을 알 수 있다.</p>
<p>앞에서 설명한 것처럼, API용 패키지를 직접 사용할 수도 있지만, 래퍼 패키지가 존재하기만 한다면 그것을 활용하는 것이 훨씬 손쉬운 옵션일 수 있다. 놀랍게도 한국의 주석훈(Seokhoon Joo)이라는 분이 그러한 기능을 하는 <code>kosis</code>(<a href="https://cran.r-project.org/web/packages/kosis/index.html" class="uri">https://cran.r-project.org/web/packages/kosis/</a>)라는 패키지를 이미 개발해 두었고, 그것을 활용하고자 한다.</p>
<p>실습 주제는 2022년 센서스 인구 기준으로 전국의 17개 시도별 ’지방소멸위험지수’를 계산하고 그래프의 형태로 표현하는 것이다.</p>
<section id="kosis에서-api-key-받기" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="kosis에서-api-key-받기"><span class="header-section-number">3.3.1</span> KOSIS에서 API KEY 받기</h4>
<ul>
<li><p>KOSIS 공유서비스 웹페이지(<a href="https://kosis.kr/openapi/" class="uri">https://kosis.kr/openapi/</a>) 접속</p></li>
<li><p>상단의 [활용신청] 탭 클릭</p>
<ul>
<li>통계청의 ONE-ID로 통합로그인(없으면 회원가입 필수)</li>
</ul></li>
<li><p>활용신청하여 사용자 인증키 획득</p>
<ul>
<li>사용자 인증키는 마이페이지에서 언제든 확인 가능</li>
</ul></li>
</ul>
</section>
<section id="패키지-설치-및-인증키-등록" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="패키지-설치-및-인증키-등록"><span class="header-section-number">3.3.2</span> 패키지 설치 및 인증키 등록</h4>
<p>우선 <code>kosis</code> 패키지를 오른쪽 하단 윈도우의 Packages 탭을 활용하여 인스톨한다. 이후에 아래와 같이 <code>kosis</code>와 <code>tidyverse</code> 패키지를 불러온다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kosis)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>kosis 패키지의 <code>kosis.setKey()</code> 함수를 이용하여 인증키를 등록한다. Your Key Here 자리에 부여받은 인증키를 붙여 넣는다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kosis.setKey</span>(<span class="at">apikey =</span> <span class="st">"Your Key Here"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="데이터-추출" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="데이터-추출"><span class="header-section-number">3.3.3</span> 데이터 추출</h4>
<p>가장 유용한 방식은 <code>kosis</code> 패키지의 <code>getStatDataFromURL()</code> 함수를 활용하는 것이다. KOSIS의 데이터 서비스 구조를 감안할 때 이 것이 좀 더 용이한 방식일 수 있다. 데이터 추출은 다음과 같이 두 단계의 과정을 거친다.</p>
<ul>
<li><p>KOSIS에서 필요한 데이터의 위치에 대한 URL 정보를 획득한다.</p></li>
<li><p><code>getStatDataFromURL()</code> 함수를 활용하여 데이터를 추출한다.</p></li>
</ul>
<p>구체적인 수행 과정은 다음과 같다.</p>
<p>첫째, KOSIS(<a href="https://kosis.kr/" class="uri">https://kosis.kr/</a>)에 로그인한다. 이것은 api key를 활용하기 위한 필수 조건이다.</p>
<p>둘째, 인구 센서스 데이터를 바탕으로 시도별 지방소멸위험지수를 계산하고자 하기 때문에, 최신 인구 센서스의 지역별 20~39세의 여성 인구와 65세 이상의 전체 인구에 대한 데이터가 필요하다. KOSIS 홈페이지를 탐색하여 필요한 데이터가 있는 위치를 찾아간다.</p>
<ul>
<li>[국내통계]-[주제별 통계]-[인구]-[인구총조사]-[인구부문]-[총조사인구(2015년 이후)]-[전수부문 (등록센서스, 2015년 이후)]-[전수기본표]-[연령 및 성별 인구]</li>
</ul>
<p>셋째, ’조회설정’을 클릭하여 다음과 같이 선택한다.</p>
<ul>
<li><p>항목: ‘총인구(명)’, ‘총인구_남자(명)’, ’총인구_여자(명)’만 선택(더 많은 항목을 선택하면 데이터가 너무 커 에러가 발생)</p></li>
<li><p>행정구역별(읍면동): ‘1 레벨’과 ’2 레벨’ 선택(’1 레벨’은 시도 수준, ’2 레벨’은 시군구 수준)</p></li>
</ul>
<p>넷째, ‘조회설정’ 창을 없앤 후(조회창의 왼편 가운데의 화살표 클릭), 표의 오른편 상단에 있는 여러개 탭 중 ‘OPENAPI’ 탭을 클릭한다. 다음과 같이 선택한다.</p>
<ul>
<li><p>조회기간 설정: ‘기간설정’ 버턴을 누른 후, 기간설정이 2022~2022년인지 확인한다.</p></li>
<li><p>응답필드 설정: 하나씩 눌러 모두 선택한 후, ‘URL생성’ 탭을 클릭한다. 그리고 나서 ‘URL 복사’ 탭을 클릭한다. URL 속에 api key가 포함되어 있음을 확인한다.</p></li>
</ul>
<p>다섯째, 다음과 같이 실행한다. “Your URL” 자리에 복사한 URL를 붙여 넣는다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>your_url <span class="ot">&lt;-</span> <span class="st">"Your URL"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data_api <span class="ot">&lt;-</span> <span class="fu">getStatDataFromURL</span>(<span class="at">url =</span> your_url)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>data_api <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  ORG_ID     TBL_ID
1    101 DT_1IN1503
2    101 DT_1IN1503
3    101 DT_1IN1503
4    101 DT_1IN1503
5    101 DT_1IN1503
                                                          TBL_NM C1 C1_NM
1 연령 및 성별 인구 – 읍면동(연도 끝자리 0 5) 시군구(그 외 연도) 00  전국
2 연령 및 성별 인구 – 읍면동(연도 끝자리 0 5) 시군구(그 외 연도) 00  전국
3 연령 및 성별 인구 – 읍면동(연도 끝자리 0 5) 시군구(그 외 연도) 00  전국
4 연령 및 성별 인구 – 읍면동(연도 끝자리 0 5) 시군구(그 외 연도) 00  전국
5 연령 및 성별 인구 – 읍면동(연도 끝자리 0 5) 시군구(그 외 연도) 00  전국
           C1_OBJ_NM  C2 C2_NM C2_OBJ_NM ITM_ID          ITM_NM
1 행정구역별(읍면동) 000  합계    연령별    T00      총인구(명)
2 행정구역별(읍면동) 000  합계    연령별    T01 총인구_남자(명)
3 행정구역별(읍면동) 000  합계    연령별    T02 총인구_여자(명)
4 행정구역별(읍면동) 005 0~4세    연령별    T00      총인구(명)
5 행정구역별(읍면동) 005 0~4세    연령별    T01 총인구_남자(명)
         ITM_NM_ENG PRD_SE PRD_DE       DT
1        Population      A   2022 51692272
2   Population_Male      A   2022 25835298
3 Population_Female      A   2022 25856974
4        Population      A   2022  1459301
5   Population_Male      A   2022   748056</code></pre>
</div>
</div>
</section>
<section id="데이터-정리-및-변형" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="데이터-정리-및-변형"><span class="header-section-number">3.3.4</span> 데이터 정리 및 변형</h4>
<p>아래와 같이 데이터를 정리한다. 최종적으로 지역별 지역소멸위험지수를 산출한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_api <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(C1, C1_NM, C2, C2_NM, ITM_ID, ITM_NM, DT) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C1, DT), as.numeric),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ITM_ID =</span> <span class="fu">case_match</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    ITM_ID, </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T00"</span> <span class="sc">~</span> <span class="st">"T"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T01"</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T02"</span> <span class="sc">~</span> <span class="st">"F"</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gender_age"</span>, ITM_ID, C2_NM, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(C1, C1_NM),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> gender_age,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> DT</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> (<span class="st">`</span><span class="at">F_20~24세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_25~29세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_30~34세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_35~39세</span><span class="st">`</span>) <span class="sc">/</span> <span class="st">`</span><span class="at">T_65세이상</span><span class="st">`</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    C1, C1_NM, index</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>여기서는 <code>case_match()</code> 함수에 주목할 필요가 있다. <code>case_match()</code> 함수는 데이터 변형을 위한 <code>tidyverse</code>의 핵심 패키지인 <code>dplyr</code>의 벡터 함수로서, 벡터의 각 요소에 조건 부합성을 검토하고 그것을 통해 새로운 값을 부여할 수 있게 해준다(과거에 <code>recode()</code>라 불렸던 함수이다). 우선 변환을 위한 컬럼을 지정하고, <code>~</code> 기호를 중심으로 왼편에 현재의 값을, 오른편에 새로운 값을 놓으면 된다. 보통 여러 조건을 나열해 모든 케이스가 새로운 값을 갖게 하지만, 간혹 해당 되는 조건이 없는 케이스를 위해 <code>.default</code> 아규먼트를 사용한다. <code>forcat</code> 패키지에서 문자형 벡터의 레벨(level)을 새로운 레벨로 교체하는데 사용되는 <code>fct_recode()</code> 함수와 유사하다. <code>case_match()</code> 함수와 유사한 함수에 <code>case_when()</code>가 있다. <code>case_match()</code> 함수가 단일 컬럼의 개별 값을 전환할 때 사용되는 함수라면, <code>case_when()</code>은단일 컬럼에 다양한 조건을 설정하거나 두 개 이상의 컬럼이 개입되는 경우에 사용할 수 있는 함수이다. 따라서 <code>case_match()</code> 함수의 경우는 컬럼명이 한 번만 등장하면 되지만, <code>case_when()</code>에서는 개별 조건에 해당 컬럼명이 등장해야 한다. 아래의 그래프에 활용의 예가 나타나 있다.</p>
</div>
</div>
<p>시도 데이터와 시군구 데이터를 분리하여 저장한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data_sido <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(C1) <span class="sc">==</span> <span class="dv">2</span>) </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>data_sigungu <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(C1) <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> <span class="sc">!</span>C1_NM <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"동부"</span>, <span class="st">"면부"</span>, <span class="st">"읍부"</span>) <span class="sc">&amp;</span> <span class="fu">str_sub</span>(C1, <span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(data_sigungu, <span class="st">"data_sigungu.rds"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">read_rds</span>(<span class="st">"data_sigungu.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 229 × 3
      C1 C1_NM    index
   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
 1 11010 종로구   0.965
 2 11020 중구     0.931
 3 11030 용산구   1.02 
 4 11040 성동구   1.00 
 5 11050 광진구   1.20 
 6 11060 동대문구 0.994
 7 11070 중랑구   0.751
 8 11080 성북구   0.929
 9 11090 강북구   0.589
10 11100 도봉구   0.578
# ℹ 219 more rows</code></pre>
</div>
</div>
</section>
<section id="그래프-작성" class="level4" data-number="3.3.5">
<h4 data-number="3.3.5" class="anchored" data-anchor-id="그래프-작성"><span class="header-section-number">3.3.5</span> 그래프 작성</h4>
<p>그래프 작성의 코드가 다소 복잡해 보인다. 이렇게 된 것은 인구소멸위험지수 연구에서 주로 사용되는 5개의 위험도 클래스의 구분법을 적용하고, 위험도 클래스별로 특정한 색상을 적용하고, 그래프의 범례에 5개의 클래스가 모두 나타나게 하려했기 때문이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data_sido_new <span class="ot">&lt;-</span> data_sido <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">index_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      index <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      index <span class="sc">&gt;=</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> index <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"2"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      index <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> index <span class="sc">&lt;</span> <span class="fl">1.0</span> <span class="sc">~</span> <span class="st">"3"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      index <span class="sc">&gt;=</span> <span class="fl">1.0</span> <span class="sc">&amp;</span> index <span class="sc">&lt;</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="st">"4"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      index <span class="sc">&gt;=</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="st">"5"</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">index_class =</span> <span class="fu">fct</span>(index_class, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>class_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#ffffbf"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#a6d96a"</span>, </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#1a9641"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>data_sido_new <span class="sc">|&gt;</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> <span class="fu">fct_reorder</span>(C1_NM, index))) <span class="sc">+</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> index_class), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(index, <span class="at">digits =</span> <span class="dv">3</span>)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Classes"</span>, </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt; 0.2"</span>, <span class="st">"0.2 ~ 0.5"</span>, <span class="st">"0.5 ~ 1.0"</span>, </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"1.0 ~ 1.5"</span>, <span class="st">"&gt;= 1.5"</span>), </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> class_color, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"인구소멸위험지수, 2022년"</span>, </span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"인구소멸위험지수"</span>, </span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exec_07_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>우선 <code>tidyverse</code>에서 문자열에 특화된 핵심 패키지인 <code>forcat</code>의 두 함수에 대해 언급하고자 한다. <code>fct()</code>는 가장 기본이 되는 함수로 일반 문자형 컬럼을 팩터형(factor) 컬럼으로 전환해주는 함수이다. 동시에 레벨을 지정할 수 있다. <code>fct_reorder()</code> 함수는 팩터 벡터의 기존 레벨의 순서를 바꾸어주는 여러 함수들 중 하나이다. <code>fct_reorder()</code>는 특정 변수의 레벨 순서를 다른 변수의 값의 순서에 의거해 바꾸어준다. 비슷한 함수에 <code>fct_reorder2()</code>가 있는데, 이것은 특정 변수의 레벨 순서를 다른 변수의 값의 순서에 의거하여 바꾸되 그 다른 변수의 값을 또 다른 변수를 통해 규정하고자 할 때 사용할 수 있다. 위의 예를 든다면, 시도의 순서를 인구소멸위험지수의 크기에 따라 배열하되, 만약 여러 연도에 걸쳐 인구소멸위험지수가 계산되었을 경우, 특정 연도(주로 가장 큰 연도)의 값에 의거해 배열하는 것이다. 이외에 레벨의 순서를 메뉴얼하게 바꿀 수 있는 <code>fct_relevel()</code> 함수, 레벨의 순서를 역방향으로 바꿀 수 있는 <code>fct_rev()</code> 함수가 빈번하게 사용된다. ggplot2 패키지의 <code>scale_fill_manual()</code> 함수 역시 매우 중요한 역할을 한다. 이것은 막대 그래프를 채울 컬러의 스케일링을 사용자가 메뉴얼하게 할 수 있게 해주는데, 컬러 팔레트(class_color), 범례의 표제와 라벨을 메뉴얼하게 적용할 수 있다. 마지막에 있는 <code>drop = FALSE</code> 아규먼트가 매우 중요한 역할을 한다. 그래프를 보면 시도 수준의 인구소멸위험지수는 양 극단의 두 계급에 케이스를 갖지 않는다. 전체 계급을 보여주는 것이 의미있다고 판단한다면, <code>drop = FALSE</code> 아규먼트를 통해 모든 계급이 범례에 드러나게 할 수 있다.</p>
</div>
</div>
</section>
<section id="또-다른-방식" class="level4" data-number="3.3.6">
<h4 data-number="3.3.6" class="anchored" data-anchor-id="또-다른-방식"><span class="header-section-number">3.3.6</span> 또 다른 방식</h4>
<p>또 다른 방식은 <code>kosis</code> 패키지의 <code>getStatData()</code> 함수를 활용하는 것이다. 해당 함수에 기관명(101)과 데이터 코드(DT_1IN503)을 아규먼트에 입력하면 데이터를 불러올 수 있다. 위의 방식의 한 연도의 모든 지역에 대한 데이터를 얻기에 용이하다면, 이 방식은 하나의 지역에 대한 시계열 데이터를 수집하는데 유용하다. 아래의 코드를 통해 서울시 종로구(코드: 11010)의 2015~2022년 데이터를 획득할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>region_code <span class="ot">&lt;-</span> <span class="st">"11010"</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>data_api <span class="ot">&lt;-</span> <span class="fu">getStatData</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">orgId =</span> <span class="dv">101</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tblId =</span> <span class="st">"DT_1IN1503"</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prdSe =</span> <span class="st">"Y"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">startPrdDe =</span> <span class="st">"2015"</span>, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">endPrdDe =</span> <span class="st">"2022"</span>, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">objL1 =</span> region_code, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">objL2 =</span> <span class="st">"ALL"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(C2) <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>region_code &lt;- “11010”+“11020”과 같은 식으로 설정하면 두 개 이상의 지역에 대한 데이터를 한꺼번에 구할 수도 있다.</p>
</div>
</div>
<p>아래와 같은 데이터 정리 및 변형 과정이 필요하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_api <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(C1, C1_NM, C2, C2_NM, ITM_ID, ITM_NM, DT, PRD_DE) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITM_ID <span class="sc">==</span> <span class="st">"T00"</span> <span class="sc">|</span> ITM_ID <span class="sc">==</span> <span class="st">"T01"</span> <span class="sc">|</span> ITM_ID <span class="sc">==</span> <span class="st">"T02"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C1, DT), as.numeric),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ITM_ID =</span> <span class="fu">case_match</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    ITM_ID, </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T00"</span> <span class="sc">~</span> <span class="st">"T"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T01"</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T02"</span> <span class="sc">~</span> <span class="st">"F"</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gender_age"</span>, ITM_ID, C2_NM, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(C1, C1_NM, PRD_DE),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> gender_age,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> DT</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> (<span class="st">`</span><span class="at">F_20~24세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_25~29세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_30~34세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_35~39세</span><span class="st">`</span>) <span class="sc">/</span> <span class="st">`</span><span class="at">T_65세이상</span><span class="st">`</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    C1, C1_NM, index, PRD_DE</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 데이터를 바탕으로 종로구의 인구소멸위험지수의 변화 추이를 관찰할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">distinct</span>(C1_NM) <span class="sc">|&gt;</span> <span class="fu">pull</span>()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PRD_DE, <span class="at">y =</span> index)) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(region, <span class="st">" 인구소멸위험지수 추이"</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">"연도"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">"인구소멸위험지수"</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exec_07_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이 모든 과정을 함수로 만들고, Base R의 <code>read_line()</code> 함수를 활용하면 초보적인 상호작용형 도구를 만들 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>exInd <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Library</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(kosis)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(DT)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(openxlsx)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Table for Searching Region Code</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  region_table <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://github.com/Sechang-Kim/gis-lab/raw/download/korea-sigungu-code(2022).xlsx"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">datatable</span>(region_table))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Input Arguments</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  aoi_code <span class="ot">&lt;-</span> <span class="fu">readline</span>(<span class="st">'지역 코드를 입력하세요: '</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">readline</span>(<span class="st">'시작 연도를 입력하세요: '</span>))</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">readline</span>(<span class="st">'종료 연도를 입력하세요: '</span>))</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data Request</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  aoi <span class="ot">&lt;-</span> <span class="fu">getStatData</span>(<span class="at">orgId =</span> <span class="dv">101</span>, <span class="at">tblId =</span> <span class="st">"DT_1IN1503"</span>, <span class="at">prdSe =</span> <span class="st">"Y"</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">startPrdDe =</span> start, <span class="at">endPrdDe =</span> end,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">objL1 =</span> aoi_code, <span class="at">objL2 =</span> <span class="st">"ALL"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">nchar</span>(C2) <span class="sc">==</span> <span class="dv">3</span>) <span class="co"># Delete 1-age interval(Only 5-age interval)</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data Cleansing</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  aoi <span class="ot">&lt;-</span> aoi <span class="sc">|&gt;</span> </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(C1, C1_NM, C2, C2_NM, ITM_ID, ITM_NM, DT, PRD_DE) <span class="sc">|&gt;</span> </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ITM_ID <span class="sc">==</span> <span class="st">"T00"</span> <span class="sc">|</span> ITM_ID <span class="sc">==</span> <span class="st">"T01"</span> <span class="sc">|</span> ITM_ID <span class="sc">==</span> <span class="st">"T02"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(<span class="fu">c</span>(C1, DT), as.numeric),</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">ITM_ID =</span> <span class="fu">case_match</span>(</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>        ITM_ID, <span class="st">"T00"</span> <span class="sc">~</span> <span class="st">"T"</span>,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"T01"</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"T02"</span> <span class="sc">~</span> <span class="st">"F"</span>),</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">"gender_age"</span>, ITM_ID, C2_NM, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">id_cols =</span> <span class="fu">c</span>(C1, C1_NM, PRD_DE),</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> gender_age,</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> DT</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">index =</span> (<span class="st">`</span><span class="at">F_20~24세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_25~29세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_30~34세</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">F_35~39세</span><span class="st">`</span>) <span class="sc">/</span> <span class="st">`</span><span class="at">T_65세이상</span><span class="st">`</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>      C1, C1_NM, index, PRD_DE</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Visualization</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  region <span class="ot">&lt;-</span> aoi<span class="sc">$</span>C1_NM[<span class="dv">1</span>] <span class="co"># For Auto-Plot Title</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  vis <span class="ot">&lt;-</span> aoi <span class="sc">|&gt;</span> </span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>PRD_DE, <span class="at">y=</span>index)) <span class="sc">+</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(region, <span class="st">" 인구소멸위험지수 추이"</span>)) <span class="sc">+</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">"연도"</span>) <span class="sc">+</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">"인구소멸위험지수"</span>) <span class="sc">+</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vis)</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>함수를 실행해 보자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exInd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="api를-활용한-naver-뉴스-데이터의-수집" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="api를-활용한-naver-뉴스-데이터의-수집"><span class="header-section-number">3.4</span> API를 활용한 NAVER 뉴스 데이터의 수집</h3>
<section id="naver-developer" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="naver-developer"><span class="header-section-number">3.4.1</span> NAVER Developer</h4>
<p>네이버의 API를 활용하기 위해서는 네이버 디벨로퍼(<a href="https://developers.naver.com/main/" class="uri">https://developers.naver.com/main/</a>)에서 오픈 API를 신청해야 한다. 절차를 정리하면 다음과 같다.</p>
<p>첫째, [Documents]에서 ‘API 공통 가이드’를 살펴본다. 특히 비로그인 방식 오픈 API가 중요한데, 그 중에서 ’검색’ 카테고리에 해당하는 뉴스, 백과사전, 블로그 등 다양한 검색 서비스에 주목한다.</p>
<p>둘째, [Products]-[서비스 API]-[검색](<a href="https://developers.naver.com/products/service-api/search/search.md" class="uri">https://developers.naver.com/products/service-api/search/search.md</a>)을 선택한다. 여기에는 ’오픈 API 이용 신청’과 ’개발 가이드 보기’가 있는데, 우선 ’개발 가이드 보기’를 숙지한 후 ’오픈 API 이용 신청’을 한다. ’개발 가이드 보기’에서 특히 다음의 몇 가지에 유의한다.</p>
<ul>
<li><p>오픈 API 이용 신청 절차</p></li>
<li><p>ClientID와 Client Secret 개념</p></li>
<li><p>요청 URL: https://openapi.naver.com/v1/search/news.json</p></li>
<li><p>파라미터: query, display, start, sort</p></li>
</ul>
<p>셋째, ’오픈 API 이용 신청’을 한다. 다음의 몇 가지에 유의한다.</p>
<ul>
<li><p>애플리케이션 이름: 아무 이름이나 입력</p></li>
<li><p>사용 API: ’검색’이 선택된 상태를 유지</p></li>
<li><p>비로그인 오픈 API 서비스 환경: ’WEB 설정’을 선택</p></li>
<li><p>웹 서비스 URL (최대 10개): ’http://localhost’를 입력(개인 PC를 이용하겠다는 것을 의미)</p></li>
</ul>
</section>
<section id="httr2-패키지-활용-처음-100개-검색-결과-추출" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="httr2-패키지-활용-처음-100개-검색-결과-추출"><span class="header-section-number">3.4.2</span> <code>httr2</code> 패키지 활용: 처음 100개 검색 결과 추출</h4>
<p>패키지를 불러온다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>’지방소멸’을 검색어로 하여 최초의 100개 검색 결과에 대한 데이터(특히, 제목과 내용)를 수집한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>search <span class="ot">&lt;-</span> <span class="st">"지방소멸"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>your_url <span class="ot">&lt;-</span> <span class="st">"https://openapi.naver.com/v1/search/news.json"</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>result_naver <span class="ot">&lt;-</span> <span class="fu">request</span>(your_url) <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_headers</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Naver-Client-ID"</span> <span class="ot">=</span> your_ClientID,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Naver-Client-Secret"</span> <span class="ot">=</span> your_Client_Secret</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">query =</span> search,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">display =</span> <span class="dv">100</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="dv">1</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort =</span> <span class="st">"date"</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>() <span class="sc">|&gt;</span> </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>View</code>(result_naver)을 샐행해 보면 결과 데이터가 복잡한 위계 구조를 가지고 있는 리스트(list) 형식의 데이터라는 것을 알 수 있다. 다섯 개의 하위 요소들 중 items가 또 다른 리스트이며, 그 리스트의 아래에 100개의 또 다른 하위 리스트가 있으며, 그 100개의 하위 리스트 각각에 우리가 원하는 정보가 다섯개의 속성(title, originallink, link, description, pubData)의 속성으로 나뉘어 존재한다는 것을 알 수 있다.</p>
<p>다음과 같은 방식으로 복잡한 위계 구조를 가진 리스트로부터 우리가 원하는 다섯 개의 속성을 추출할 수 있다. 우선 해당 리스트를 tibble 데이터 형식으로 바꾼다. 이것은 리스트를 tibble의 리스트 컬럼(list column)으로 바꾸는 것이다. 이렇게 하면 리스트를 훨씬 더 손쉽게 다룰 수 있게 된다. 이러한 과정에 리스트 중 원하는 데이터가 포함되어 있는 부분(여기서는 items)만 추출한다. 그리고 나서 <code>tidyr</code> 패키지가 제공하는 함수(이 경우는 <code>unnest_wider()</code> 함수)를 활용하여 우리가 원하는 정보를 정돈된 데이터 형식으로 추출한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>naver_tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">naver =</span> result_naver<span class="sc">$</span>items)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>naver_res <span class="ot">&lt;-</span> naver_tb <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(naver)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>naver_res <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  title                                   originallink link  description pubDate
  &lt;chr&gt;                                   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;  
1 숨겨진 곳을 핫플레이스로...'숨핫' 본편… https://www… http… "'숨-핫'은… Fri, 1…
2 충주시, 근로활동 참여 대학생 대상 인구… http://www.… http… "시 관계자… Fri, 1…
3 한국마사회, 국민권익위원회 등과 업무협… https://www… http… "한국마사…  Fri, 1…
4 마사회, 국민권익위원회 등과 복지 사각…  https://www… http… "정기환 마… Fri, 1…
5 [특별기고] 포천은 교육발전특구 지정이 … https://www… http… "저출생과 … Fri, 1…</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>unnest_wider()</code>와 <code>unnest_longer()</code> 함수는 <code>tidyr</code> 패키지가 제공하는 것으로, 복잡한 위계 구조를 가진 리스트 데이터로부터 원하는 데이터 만들 추출해 정돈된 형식의 데이터 프레임을 만들 때 가장 많이 사용된다. 리스트 컬럼은 유명(named) 리스트 컬럼과 무명(unnamed) 리스트 컬럼으로 크게 대별된다. 유명 리스트 컬럼은 마치 변수명과 같은 이름이 리스트열에 부여되어 있고 모든 리스트열의 길이가 동일한 것이고, 무명 리스트 컬럼은 이름이 부여되어 있지 않고 길이도 서로 다른 경우가 많다. 따라서 유명 리스트 컬럼은 최종적으로 변수가 되고, 무명 리스트 컬럼은 최종적으로 행이 된다고 생각할 수 있다. 유명 리시트 컬럼에는 <code>unnest_wider()</code> 함수를, 무명 리스트 컬럼에는 <code>unnest_longer()</code> 함수를 적용하여 데이터를 추출해낸다.</p>
</div>
</div>
</section>
<section id="httr2-패키지-활용-for-함수를-이용하여-1000개-검색-결과-추출" class="level4" data-number="3.4.3">
<h4 data-number="3.4.3" class="anchored" data-anchor-id="httr2-패키지-활용-for-함수를-이용하여-1000개-검색-결과-추출"><span class="header-section-number">3.4.3</span> <code>httr2</code> 패키지 활용: <code>for</code> 함수를 이용하여 1,000개 검색 결과 추출</h4>
<p>반복 과정을 통해 1,000개까지 데이터를 추출해 본다. 여기서는 for 문을 활용하지만</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>all_news <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>search <span class="ot">&lt;-</span> <span class="st">"지방소멸"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  news <span class="ot">&lt;-</span> <span class="fu">request</span>(your_url) <span class="sc">|&gt;</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_headers</span>(</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"X-Naver-Client-ID"</span> <span class="ot">=</span> your_ClientID,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"X-Naver-Client-Secret"</span> <span class="ot">=</span> your_Client_Secret</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">query =</span> search,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">display =</span> <span class="dv">100</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> i,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">sort =</span> <span class="st">"date"</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_json</span>()</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># body &lt;- data.frame(t(sapply(news$item, data.frame)))</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  news_tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">naver =</span> news<span class="sc">$</span>items)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  news_res <span class="ot">&lt;-</span> news_tb <span class="sc">|&gt;</span> <span class="fu">unnest_wider</span>(naver)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  all_news <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_news, news_res)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 모든 과정을 자동화하기 위해 함수를 만들어 본다. <code>naver_extractor()</code> 함수는 네이버 뉴스에서 특정한 검색어를 통해 기사를 추출할 수 있게 해주는 것이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>naver_extractor <span class="ot">&lt;-</span> <span class="cf">function</span>(a_url, search_item, <span class="at">n_start =</span> <span class="dv">1</span>, <span class="at">n_display =</span> <span class="dv">100</span>){</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  news <span class="ot">&lt;-</span> <span class="fu">request</span>(a_url) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_headers</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Naver-Client-ID"</span> <span class="ot">=</span> your_ClientID,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Naver-Client-Secret"</span> <span class="ot">=</span> your_Client_Secret</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">query =</span> search_item,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">display =</span> n_display,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> n_start,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort =</span> <span class="st">"date"</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>() <span class="sc">|&gt;</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  news_tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">naver =</span> news<span class="sc">$</span>items)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  news_res <span class="ot">&lt;-</span> news_tb <span class="sc">|&gt;</span> <span class="fu">unnest_wider</span>(naver)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 함수를 이용해 데이터를 추출해 본다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>res_1 <span class="ot">&lt;-</span> <span class="fu">naver_extractor</span>(<span class="at">a_url =</span> your_url, <span class="at">search_item =</span> <span class="st">"지방소멸"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>res_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n_start <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  news_res <span class="ot">&lt;-</span> <span class="fu">naver_extractor</span>(<span class="at">a_url =</span> your_url, <span class="at">search_item =</span> <span class="st">"지방소멸"</span>, <span class="at">n_start =</span> n_start)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  res_2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res_2, news_res)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>이렇게 수집된 문자열 데이터는 텍스트 마이닝(text mining)을 위한 중요한 원천이 되는데, 분석을 위해서는 데이터 정처리 과정이 필수적이다. 다음의 링크(<a href="https://r2bit.com/book_tm/" class="uri">https://r2bit.com/book_tm/</a>)를 참고할 수 있다. 또한 다음의 책을 참고할 수 있다<span class="citation" data-cites="gimyeongu2021">(<a href="#ref-gimyeongu2021" role="doc-biblioref">김영우 2021</a>)</span>.</p>
</div>
</div>



</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gimyeongu2021" class="csl-entry" role="listitem">
김영우. 2021. <em>쉽게 배우는 R 텍스트 마이닝</em>. 서울: 이지스퍼블리싱.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./exec_06.html" class="pagination-link  aria-label=" 데이터="" 탐색하기"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">데이터 탐색하기</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./exec_08.html" class="pagination-link" aria-label="데이터로 소통하기: Quarto 입문">
        <span class="nav-page-text">데이터로 소통하기: Quarto 입문</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Sang-Il Lee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://sangillee.snu.ac.kr/">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:si_lee@snu.ac.kr">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sangillee66">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>